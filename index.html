<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Ollu-cybersaints-lab-documentation by Ashkore</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Ollu-cybersaints-lab-documentation</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/Ashkore/OLLU-AITP-Lab-Documentation" class="btn">View on GitHub</a>
      <a href="https://github.com/Ashkore/OLLU-AITP-Lab-Documentation/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Ashkore/OLLU-AITP-Lab-Documentation/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="lab-hardware--layout" class="anchor" href="#lab-hardware--layout" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lab Hardware / Layout</h1>

<p>2 Unmanaged trednet gigabit switches
2 Poweredge T300 Server
    1 Intel Core 2 Duo E6305 @ 1.86GHz
    24GB Ram
    4 250GB HDD's &gt; Raid 0
1 Poweredge T605 Server
    2 Quad-Core AMD Opteron 2350
    32GB Ram
    4 250GB HDD's &gt; Raid 0</p>

<h5>
<a id="lab-hardware--layout-image" class="anchor" href="#lab-hardware--layout-image" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lab Hardware / Layout Image</h5>

<h1>
<a id="lab-software--layout" class="anchor" href="#lab-software--layout" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lab Software / Layout</h1>

<p>Each Poweredge server is running ESX 6.0
A virtual Vcenter Server Appliance is running on the T605
A virtual Debian DHCP/Apache2 server is running DNSMASQ
The rest of the VM's are VM's from <a href="http://www.Vulnhub.com">www.Vulnhub.com</a></p>

<hr>

<h1>
<a id="configuration-detials" class="anchor" href="#configuration-detials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration detials</h1>

<p>Each ESX host has 3 scripts running on it:
    Revert_Snapshots.sh, Create_Snapshots.sh, Script.sh
    All 3 are stored in the /root directory of the ESX host.
The DHCP/Apache2 server has 2 scripts on it:
    IP_TO_MAC.sh and Order.sh
    Both are stored in the /root directory of the VM.</p>

<hr>

<h1>
<a id="scripts" class="anchor" href="#scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scripts</h1>

<h2>
<a id="esx" class="anchor" href="#esx" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ESX</h2>

<p>Revert_Snapshots.sh
<code>VMIDS=$(vim-cmd vmsvc/getallvms | grep -v 01_Vcenter | grep -v 02_DNS_DHCP | awk '{print $1 }' | grep -v Vmid)
    for VMID in $VMIDS
    do
            case $VMID in
                    ''|*[!0-9]*);;
                    *)
                    vim-cmd vmsvc/get.snapshot $VMID | grep "Fresh Install"
                    if [ $? -eq 0 ]; then
                            echo $(vim-cmd vmsvc/get.summary $VMID | grep name)
                            SnapShotID=$(vim-cmd vmsvc/snapshot.get $VMID | grep "Fresh Install" -A 1 | grep "Id" | awk '{print $4}')
                            vim-cmd vmsvc/snapshot.revert $VMID $SnapShotID 0
                            vim-cmd vmsvc/power.on $VMID
                    fi
                    ;;
            esac
    done
</code>
Create_Snapshots.sh
<code>VMIDS=$(vim-cmd vmsvc/getallvms | grep -v 01_Vcenter | grep -v 02_DNS_DHCP | awk '{print $1 }' | grep -v Vmid)
    for VMID in $VMIDS
    do
            case $VMID in
                    ''|*[!0-9]*);;
                    *)
                    vim-cmd vmsvc/get.snapshot $VMID | grep "Fresh Install" &gt; /dev/null
                    if [ ! $? -eq 0 ]; then
                            vim-cmd vmsvc/snapshot.create $VMID "Fresh Install"
                    fi
                    ;;
            esac
    done
</code>
Script.sh
<code>VMIDS=$(vim-cmd vmsvc/getallvms | awk '{print $1 }' | grep -v Vmid)
    echo "" &gt; MAC_ADDRESSES
    for VMID in $VMIDS
    do
            case $VMID in
                    ''|*[!0-9]*);;
                    *)
                    MacAddress=$(vim-cmd vmsvc/device.getdevices $VMID | grep macAddress | sed 's/macAddress = "//' | sed 's/",//' | sed -r 's/\s+//g')
                    VmName=$(vim-cmd vmsvc/get.summary $VMID | grep name | sed 's/name = "//' | sed 's/",//' | sed -r 's/\s+//g')
                    echo $MacAddress        $VmName &gt;&gt; MAC_ADDRESSES
                    ;;
            esac
    done
</code></p>

<h2>
<a id="dhcpapache2" class="anchor" href="#dhcpapache2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DHCP/Apache2</h2>

<p>IP_TO_MAC.sh</p>

<p>Order.sh</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Ashkore/OLLU-AITP-Lab-Documentation">Ollu-cybersaints-lab-documentation</a> is maintained by <a href="https://github.com/Ashkore">Ashkore</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
